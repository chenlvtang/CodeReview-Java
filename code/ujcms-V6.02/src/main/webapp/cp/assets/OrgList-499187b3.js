import{d as F,p as X,r as i,v as H,a as V,c as B,e as N,w as r,i as s,h as l,g as G,u as W,X as Y,o as Z,b as x,I as ee,j as Q,f as le,aD as ae,aJ as te,E as oe,aK as ne,k as I,t as D,a5 as se,a2 as de,as as U,V as re}from"./index-285670b0.js";import{q as M,x as ue,y as ie,z as me,A as P,B as pe}from"./user-d25c6116.js";import{a as S,_ as ve,b as be,c as fe}from"./QueryItem.vue_vue_type_script_setup_true_lang-c40055fe.js";import{_ as ce}from"./ListMove.vue_vue_type_script_setup_true_lang-591ffc50.js";import{b as ge,t as ye}from"./tree-73f11865.js";import{_ as $e}from"./DialogForm.vue_vue_type_script_setup_true_lang-2cec4ef8.js";const Ve={name:"OrgForm"},he=F({...Ve,props:{modelValue:{type:Boolean,required:!0},beanId:{type:Number,default:null},beanIds:{type:Array,required:!0},parentId:{type:Number,required:!0},showGlobalData:{type:Boolean,required:!0}},emits:{"update:modelValue":null,finished:null},setup(y,{emit:E}){const k=y,{showGlobalData:h,modelValue:C}=X(k),f=i(),t=i({}),c=i([]),$=async u=>{c.value=ge(ye(await M({current:!h.value})),u==null?void 0:u.id)},q=async u=>{await $(u),E("finished")};return H(C,()=>{C.value&&$()}),(u,o)=>{const O=V("el-tree-select"),v=V("el-form-item"),m=V("el-input");return B(),N($e,{values:t.value,"onUpdate:values":o[5]||(o[5]=n=>t.value=n),name:u.$t("menu.user.org"),"query-bean":s(ue),"create-bean":s(ie),"update-bean":s(me),"delete-bean":s(P),"bean-id":y.beanId,"bean-ids":y.beanIds,focus:f.value,"init-values":n=>{var b;return{parentId:(n==null?void 0:n.id)!==y.parentId&&(b=n==null?void 0:n.parentId)!=null?b:y.parentId}},"to-values":n=>({...n}),"disable-delete":n=>{var b;return n.id<=1||n.id===((b=c.value[0])==null?void 0:b.id)},perms:"org","model-value":y.modelValue,"onUpdate:modelValue":o[6]||(o[6]=n=>u.$emit("update:modelValue",n)),onFinished:q,onBeanChange:o[7]||(o[7]=()=>$())},{default:r(({isEdit:n})=>{var b;return[!n||t.value.id!==((b=c.value[0])==null?void 0:b.id)?(B(),N(v,{key:0,prop:"parentId",label:u.$t("org.parent"),rules:{required:!0,message:()=>u.$t("v.required")}},{default:r(()=>[l(O,{modelValue:t.value.parentId,"onUpdate:modelValue":o[0]||(o[0]=p=>t.value.parentId=p),data:c.value,"node-key":"id",props:{label:"name",disabled:"disabled"},"default-expanded-keys":c.value.map(p=>p.id),"render-after-expand":!1,"check-strictly":"",class:"w-full"},null,8,["modelValue","data","default-expanded-keys"])]),_:1},8,["label","rules"])):G("",!0),l(v,{prop:"name",label:u.$t("org.name"),rules:{required:!0,message:()=>u.$t("v.required")}},{default:r(()=>[l(m,{ref_key:"focus",ref:f,modelValue:t.value.name,"onUpdate:modelValue":o[1]||(o[1]=p=>t.value.name=p),maxlength:"50"},null,8,["modelValue"])]),_:1},8,["label","rules"]),l(v,{prop:"address",label:u.$t("org.address")},{default:r(()=>[l(m,{modelValue:t.value.address,"onUpdate:modelValue":o[2]||(o[2]=p=>t.value.address=p),maxlength:"255"},null,8,["modelValue"])]),_:1},8,["label"]),l(v,{prop:"phone",label:u.$t("org.phone")},{default:r(()=>[l(m,{modelValue:t.value.phone,"onUpdate:modelValue":o[3]||(o[3]=p=>t.value.phone=p),maxlength:"100"},null,8,["modelValue"])]),_:1},8,["label"]),l(v,{prop:"contacts",label:u.$t("org.contacts")},{default:r(()=>[l(m,{modelValue:t.value.contacts,"onUpdate:modelValue":o[4]||(o[4]=p=>t.value.contacts=p),maxlength:"100"},null,8,["modelValue"])]),_:1},8,["label"])]}),_:1},8,["values","name","query-bean","create-bean","update-bean","delete-bean","bean-id","bean-ids","focus","init-values","to-values","disable-delete","model-value"])}}}),we={class:"mb-3"},_e={class:"app-block mt-3"},ke={name:"OrgList"},Ue=F({...ke,setup(y){const{t:E}=W(),k=i({}),h=i(),C=i(),f=i([]),t=i([]),c=i(!1),$=i(!1),q=i(),u=Y(()=>f.value.map(e=>e.id)),o=i(!1),O=i(1),v=i(!1),m=async()=>{var e;c.value=!0;try{f.value=await M({...ae(k.value),current:!v.value,Q_OrderBy:h.value}),o.value=Object.values(k.value).filter(a=>a!==void 0&&a!=="").length>0||h.value!==void 0,O.value=(e=f.value[0])==null?void 0:e.id}finally{c.value=!1}};Z(m);const n=({column:e,prop:a,order:g})=>{var w;a?h.value=((w=e.sortBy)!=null?w:a)+(g==="descending"?"_desc":""):h.value=void 0,m()},b=()=>m(),p=()=>{C.value.clearSort(),te(k.value),h.value=void 0,m()},R=e=>{q.value=void 0,e!=null&&(O.value=e),$.value=!0},z=e=>{q.value=e,$.value=!0},j=async e=>{await P(e),m(),oe.success(E("success"))},A=e=>e.id>1,T=async(e,a)=>{const g=ne(e,f.value,a);await pe(g),await m(),e.forEach(w=>{C.value.toggleRowSelection(f.value.find(L=>L.id===w.id))})};return(e,a)=>{const g=V("el-button"),w=V("el-popconfirm"),L=V("el-checkbox"),_=V("el-table-column"),J=V("el-table"),K=x("loading");return B(),ee("div",null,[Q("div",we,[l(s(ve),{params:k.value,onSearch:b,onReset:p},{default:r(()=>[l(s(S),{label:e.$t("org.name"),name:"Q_Contains_name"},null,8,["label"]),l(s(S),{label:e.$t("org.address"),name:"Q_Contains_address"},null,8,["label"]),l(s(S),{label:e.$t("org.phone"),name:"Q_Contains_phone"},null,8,["label"]),l(s(S),{label:e.$t("org.contacts"),name:"Q_Contains_contacts"},null,8,["label"])]),_:1},8,["params"])]),Q("div",null,[l(g,{type:"primary",icon:s(se),onClick:a[0]||(a[0]=()=>R())},{default:r(()=>[I(D(e.$t("add")),1)]),_:1},8,["icon"]),l(w,{title:e.$t("confirmDelete"),onConfirm:a[1]||(a[1]=()=>j(t.value.map(d=>d.id)))},{reference:r(()=>[l(g,{disabled:t.value.length<=0,icon:s(de)},{default:r(()=>[I(D(e.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),l(ce,{class:"ml-2",disabled:t.value.length<=0||o.value||s(U)("org:update"),onMove:a[2]||(a[2]=d=>T(t.value,d))},null,8,["disabled"]),s(re).globalPermission?(B(),N(L,{key:0,modelValue:v.value,"onUpdate:modelValue":a[3]||(a[3]=d=>v.value=d),class:"ml-2 align-middle",label:e.$t("globalData"),border:"",onChange:a[4]||(a[4]=()=>m())},null,8,["modelValue","label"])):G("",!0),l(s(be),{name:"org",class:"ml-2"})]),Q("div",_e,[le((B(),N(J,{ref_key:"table",ref:C,"row-key":"id",data:f.value,onSelectionChange:a[5]||(a[5]=d=>t.value=d),onRowDblclick:a[6]||(a[6]=d=>z(d.id)),onSortChange:n},{default:r(()=>[l(s(fe),{name:"org"},{default:r(()=>[l(_,{type:"selection",selectable:A,width:"45"}),l(_,{property:"id",label:"ID",width:"64",sortable:"custom"}),l(_,{property:"name",label:e.$t("org.name"),sortable:"custom","min-width":"120","show-overflow-tooltip":""},{default:r(({row:d})=>[I(D(d.names.join(" / ")),1)]),_:1},8,["label"]),l(_,{property:"address",label:e.$t("org.address"),sortable:"custom",display:"none","min-width":"100","show-overflow-tooltip":""},null,8,["label"]),l(_,{property:"phone",label:e.$t("org.phone"),sortable:"custom","min-width":"100","show-overflow-tooltip":""},null,8,["label"]),l(_,{property:"contacts",label:e.$t("org.contacts"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),l(_,{label:e.$t("table.action")},{default:r(({row:d})=>[l(g,{type:"primary",disabled:s(U)("org:create"),size:"small",link:"",onClick:()=>R(d.id)},{default:r(()=>[I(D(e.$t("addChild")),1)]),_:2},1032,["disabled","onClick"]),l(g,{type:"primary",disabled:s(U)("org:update"),size:"small",link:"",onClick:()=>z(d.id)},{default:r(()=>[I(D(e.$t("edit")),1)]),_:2},1032,["disabled","onClick"]),l(w,{title:e.$t("confirmDelete"),onConfirm:()=>j([d.id])},{reference:r(()=>[l(g,{type:"primary",disabled:!A(d)||s(U)("org:delete"),size:"small",link:""},{default:r(()=>[I(D(e.$t("delete")),1)]),_:2},1032,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data"])),[[K,c.value]])]),l(he,{modelValue:$.value,"onUpdate:modelValue":a[7]||(a[7]=d=>$.value=d),"bean-id":q.value,"bean-ids":s(u),"parent-id":O.value,"show-global-data":v.value,onFinished:m},null,8,["modelValue","bean-id","bean-ids","parent-id","show-global-data"])])}}});export{Ue as default};
