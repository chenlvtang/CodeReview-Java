System.register(["./index-legacy-1e63c30f.js"],(function(e,a){"use strict";var l,t,s,u,r,o,d,n,i,p,c,m,v,g,h,w,f,y,V,b,x,$,_,k,q,M,C,P,U,S,I,L,A,F,D,E,R,B,N,O,T,j,G,J=document.createElement("style");return J.textContent="[data-v-ab3ba95c] .captcha .el-input-group__append{padding:0}\n",document.head.appendChild(J),{setters:[e=>{l=e.d,t=e.u,s=e.r,u=e.o,r=e.q,o=e.a,d=e.b,n=e.c,i=e.e,p=e.w,c=e.f,m=e.g,v=e.h,g=e.i,h=e.s,w=e.j,f=e.k,y=e.t,V=e.l,b=e.m,x=e.n,$=e.E,_=e.p,k=e.v,q=e.x,M=e.y,C=e.z,P=e.A,U=e.B,S=e.C,I=e.D,L=e.F,A=e.G,F=e.H,D=e.I,E=e.J,R=e.K,B=e.L,N=e.M,O=e.N,T=e.O,j=e.P,G=e._}],execute:function(){const a=l({name:"ChangePassword",props:{modelValue:{type:Boolean,required:!0}},emits:{"update:modelValue":null},setup(e,{emit:a}){const{t:l}=t(),_=s({}),k=s(),q=s(),M=s(!1),C=s(!1),P=s(""),U=s();u((async()=>{M.value=!0;try{P.value=await r()}finally{M.value=!1}}));const S=()=>{k.value.validate((async e=>{if(e){C.value=!0;try{const e=b(_.value.password,P.value),t=b(_.value.newPassword,P.value),s=await x({..._.value,password:e,newPassword:t,passwordAgain:void 0});if(0!==s.status)return void(U.value=s.message);U.value=void 0,k.value.resetFields(),$.success(l("success")),a("update:modelValue",!1)}finally{C.value=!1}}}))};return(a,l)=>{const t=o("el-alert"),s=o("el-input"),u=o("el-form-item"),r=o("el-button"),b=o("el-form"),x=o("el-dialog"),$=d("loading");return n(),i(x,{title:a.$t("changePassword"),"model-value":e.modelValue,"onUpdate:modelValue":l[4]||(l[4]=e=>a.$emit("update:modelValue",e)),onOpened:l[5]||(l[5]=()=>{q.value?.focus(),k.value.resetFields()})},{default:p((()=>[c((n(),i(b,{ref_key:"form",ref:k,model:_.value,"label-width":"150px","label-position":"right"},{default:p((()=>[U.value?(n(),i(t,{key:0,title:U.value,type:"error",class:"mb-3",closable:!1,"show-icon":""},null,8,["title"])):m("",!0),v(u,{prop:"username",label:a.$t("user.username"),rules:[{required:!0,message:()=>a.$t("v.required")}]},{default:p((()=>[v(s,{ref_key:"focus",ref:q,modelValue:_.value.username,"onUpdate:modelValue":l[0]||(l[0]=e=>_.value.username=e),maxlength:"30"},null,8,["modelValue"])])),_:1},8,["label","rules"]),v(u,{prop:"password",label:a.$t("user.origPassword"),rules:[{required:!0,message:()=>a.$t("v.required")}]},{default:p((()=>[v(s,{modelValue:_.value.password,"onUpdate:modelValue":l[1]||(l[1]=e=>_.value.password=e),maxlength:"50","show-password":""},null,8,["modelValue"])])),_:1},8,["label","rules"]),v(u,{prop:"newPassword",label:a.$t("user.newPassword"),rules:[{required:!0,message:()=>a.$t("v.required")},{min:g(h).passwordMinLength,max:g(h).passwordMaxLength,message:()=>a.$t("user.error.passwordLength",{min:g(h).passwordMinLength,max:g(h).passwordMaxLength})},{pattern:new RegExp(g(h).passwordPattern),message:()=>a.$t(`user.error.passwordPattern.${g(h).passwordStrength}`)}]},{default:p((()=>[v(s,{modelValue:_.value.newPassword,"onUpdate:modelValue":l[2]||(l[2]=e=>_.value.newPassword=e),maxlength:g(h).passwordMaxLength,"show-password":""},null,8,["modelValue","maxlength"])])),_:1},8,["label","rules"]),v(u,{prop:"passwordAgain",label:a.$t("user.passwordAgain"),rules:[{required:!0,message:()=>a.$t("v.required")},{validator:(e,l,t)=>{l===_.value.newPassword?t():t(a.$t("user.error.passwordNotMatch"))}}]},{default:p((()=>[v(s,{modelValue:_.value.passwordAgain,"onUpdate:modelValue":l[3]||(l[3]=e=>_.value.passwordAgain=e),maxlength:"50","show-password":""},null,8,["modelValue"])])),_:1},8,["label","rules"]),w("div",null,[v(r,{loading:C.value,type:"primary","native-type":"submit",onClick:V(S,["prevent"])},{default:p((()=>[f(y(a.$t("submit")),1)])),_:1},8,["loading","onClick"])])])),_:1},8,["model"])),[[$,M.value]])])),_:1},8,["title","model-value"])}}}),J=l({name:"GetShortMessage",props:{modelValue:{type:Boolean,required:!0}},emits:{"update:modelValue":null,finish:null},setup(e,{emit:a}){const l=e,{modelValue:u}=_(l),{t:r}=t(),d=s(),c=s(),h=s({}),b=s(!1),x=s(),S=s(),I=s(),L=async()=>{const{token:e,image:a}=await P();S.value="data:image/png;base64,"+a,I.value=e};k(u,(()=>{u.value&&L()}));const A=()=>{d.value.validate((async e=>{if(e){b.value=!0;try{const e=await U(I.value??"",h.value.captcha,h.value.mobile,3);if(0!==e.status)return void(x.value=e.message);x.value=void 0,d.value.resetFields(),$.success(r("success")),a("finish",e.result.shortMessageId),a("update:modelValue",!1)}finally{b.value=!1}}}))};return(a,l)=>{const t=o("el-alert"),s=o("el-input"),u=o("el-form-item"),r=o("el-image"),$=o("el-button"),_=o("el-form"),k=o("el-dialog");return n(),i(k,{title:a.$t("getShortMessage"),"model-value":e.modelValue,width:"576px","onUpdate:modelValue":l[3]||(l[3]=e=>a.$emit("update:modelValue",e)),onOpened:l[4]||(l[4]=()=>{c.value?.focus(),d.value.resetFields()})},{default:p((()=>[v(_,{ref_key:"form",ref:d,model:h.value,"label-width":"150px","label-position":"right"},{default:p((()=>[x.value?(n(),i(t,{key:0,title:x.value,type:"error",class:"mb-3",closable:!1,"show-icon":""},null,8,["title"])):m("",!0),v(u,{prop:"mobile",label:a.$t("mobile"),rules:[{required:!0,message:()=>a.$t("v.required")},{asyncValidator:async(e,l,t)=>{await g(q)(l)?t(a.$t("mobileNotExist")):t()},trigger:"blur"}]},{default:p((()=>[v(s,{ref_key:"focus",ref:c,modelValue:h.value.mobile,"onUpdate:modelValue":l[0]||(l[0]=e=>h.value.mobile=e),maxlength:"30"},null,8,["modelValue"])])),_:1},8,["label","rules"]),v(u,{prop:"captcha",label:a.$t("captcha"),rules:[{required:!0,message:()=>a.$t("v.required")},{asyncValidator:async(e,l,t)=>{null!=I.value&&await g(M)(I.value,l)?t():t(a.$t("captchaIncorrect"))},trigger:"blur"}],class:"captcha"},{default:p((()=>[v(s,{modelValue:h.value.captcha,"onUpdate:modelValue":l[2]||(l[2]=e=>h.value.captcha=e),name:"captcha",placeholder:a.$t("captcha"),"prefix-icon":g(C)},{append:p((()=>[v(r,{src:S.value,style:{height:"30px","margin-right":"1px"},class:"rounded-r cursor-pointer",title:a.$t("clickToRetrieveCaptcha"),onClick:l[1]||(l[1]=()=>L())},null,8,["src","title"])])),_:1},8,["modelValue","placeholder","prefix-icon"])])),_:1},8,["label","rules"]),w("div",null,[v($,{loading:b.value,type:"primary","native-type":"submit",onClick:V(A,["prevent"])},{default:p((()=>[f(y(a.$t("submit")),1)])),_:1},8,["loading","onClick"])])])),_:1},8,["model"])])),_:1},8,["title","model-value"])}}}),z={class:"h-full p-3 bg-gray-100"},H={class:"py-5 text-center text-3xl font-bold text-primary"},K={class:"mt-2 text-right"};e("default",G(l({__name:"LoginPage",setup(e){const{t:l}=t(),d=s(),c=s({}),h=s(),x=s(!1),$=s(!1),_=s(),k=s(),q=s(),U=s(),G=s(!1),Q=s(),W=S(),X=I(),Y=s(!1),Z=s(!1),ee=s(60),ae=s(l("getShortMessage"));L(),A();const le=async()=>{const{token:e,image:a}=await P();_.value="data:image/png;base64,"+a,k.value=e},te=async()=>{x.value=await N(),x.value&&le()};u((async()=>{h.value.focus(),h.value.select(),te(),(async()=>{$.value=await O()})()})),F((()=>{Q.value=W.query.redirect}));const se=e=>{q.value=e,ee.value-=1,ae.value=String(ee.value);const a=setInterval((()=>{ee.value-=1,ae.value=String(ee.value),ee.value<=0&&(ae.value=l("getShortMessage"),ee.value=60,clearInterval(a))}),1e3)},ue=()=>{d.value.validate((async e=>{if(e){G.value=!0;try{const e=await r(),a=b(c.value.password,e),t=await T({...c.value,password:a,captchaToken:k.value,shortMessageId:q.value});if(0!==t.status)return te(),void(U.value=t.message);null!=t.result.remainingDays&&j.alert(l("passwordRemaingDays",{remainingDays:t.result.remainingDays}),{type:"warning"}),Q.value?X.push(Q.value):window.location.reload()}finally{G.value=!1}}}))};return(e,l)=>{const t=o("el-alert"),s=o("el-input"),u=o("el-form-item"),r=o("el-button"),b=o("el-image"),q=o("el-form");return n(),D("div",z,[v(q,{ref_key:"form",ref:d,model:c.value,class:"mx-auto md:max-w-xs"},{default:p((()=>[w("h3",H,y(g("UJCMS")),1),U.value?(n(),i(t,{key:0,title:U.value,type:"error",class:"mb-3",closable:!1,"show-icon":""},null,8,["title"])):m("",!0),v(u,{prop:"username",rules:[{required:!0,message:()=>e.$t("v.required")}]},{default:p((()=>[v(s,{ref_key:"focus",ref:h,modelValue:c.value.username,"onUpdate:modelValue":l[0]||(l[0]=e=>c.value.username=e),name:"username",placeholder:e.$t("username"),"prefix-icon":g(E),autocomplete:"on"},null,8,["modelValue","placeholder","prefix-icon"])])),_:1},8,["rules"]),v(u,{prop:"password",rules:[{required:!0,message:()=>e.$t("v.required")}]},{default:p((()=>[v(s,{ref:"password",modelValue:c.value.password,"onUpdate:modelValue":l[1]||(l[1]=e=>c.value.password=e),type:"password",name:"password",placeholder:e.$t("password"),"prefix-icon":g(R),"show-password":""},null,8,["modelValue","placeholder","prefix-icon"])])),_:1},8,["rules"]),$.value?(n(),i(u,{key:1,prop:"shortMessageValue",rules:[{required:!0,message:()=>e.$t("v.required")}]},{default:p((()=>[v(s,{modelValue:c.value.shortMessageValue,"onUpdate:modelValue":l[3]||(l[3]=e=>c.value.shortMessageValue=e),name:"shortMessageValue",placeholder:e.$t("shortMessage"),"prefix-icon":g(B)},{append:p((()=>[v(r,{disabled:ee.value<60,onClick:l[2]||(l[2]=()=>Z.value=!0)},{default:p((()=>[f(y(ae.value),1)])),_:1},8,["disabled"])])),_:1},8,["modelValue","placeholder","prefix-icon"])])),_:1},8,["rules"])):m("",!0),x.value?(n(),i(u,{key:2,prop:"captcha",rules:[{required:!0,message:()=>e.$t("v.required")},{asyncValidator:async(a,l,t)=>{null!=k.value&&await g(M)(k.value,l)?t():t(e.$t("captchaIncorrect"))},trigger:"blur"}],class:"captcha"},{default:p((()=>[v(s,{modelValue:c.value.captcha,"onUpdate:modelValue":l[5]||(l[5]=e=>c.value.captcha=e),name:"captcha",placeholder:e.$t("captcha"),"prefix-icon":g(C)},{append:p((()=>[v(b,{src:_.value,style:{height:"30px","margin-right":"1px"},class:"rounded-r cursor-pointer",title:e.$t("clickToRetrieveCaptcha"),onClick:l[4]||(l[4]=()=>le())},null,8,["src","title"])])),_:1},8,["modelValue","placeholder","prefix-icon"])])),_:1},8,["rules"])):m("",!0),v(r,{type:"primary","native-type":"submit",class:"w-full",loading:G.value,onClick:V(ue,["prevent"])},{default:p((()=>[f(y(e.$t("login")),1)])),_:1},8,["loading","onClick"]),w("div",K,[v(r,{type:"primary",link:"",onClick:l[6]||(l[6]=()=>Y.value=!0)},{default:p((()=>[f(y(e.$t("changePassword")),1)])),_:1})])])),_:1},8,["model"]),v(a,{modelValue:Y.value,"onUpdate:modelValue":l[7]||(l[7]=e=>Y.value=e)},null,8,["modelValue"]),v(J,{modelValue:Z.value,"onUpdate:modelValue":l[8]||(l[8]=e=>Z.value=e),onFinish:se},null,8,["modelValue"])])}}}),[["__scopeId","data-v-ab3ba95c"]]))}}}));
