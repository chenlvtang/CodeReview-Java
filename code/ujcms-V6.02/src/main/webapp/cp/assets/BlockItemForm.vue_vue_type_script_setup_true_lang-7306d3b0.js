import{a as Q}from"./config-43502fd6.js";import{G as Y,H as Z,E as x,t as _}from"./content-214478a8.js";import{a as ee,_ as le}from"./DialogForm.vue_vue_type_script_setup_true_lang-2cec4ef8.js";import{a as G}from"./FileListUpload.vue_vue_type_style_index_0_scoped_cd89d899_lang-908ae973.js";import{d as J,p as K,r as I,v as ae,a as k,c as i,e as p,w as d,h as o,k as N,t as O,I as h,a8 as P,j as X,$ as te,a7 as R,X as ue,o as oe,g as v,i as u}from"./index-285670b0.js";import{B as de}from"./BaseUpload-8033ede3.js";const re=["onClick"],ne=["src"],ie=J({__name:"ImageExtractor",props:{modelValue:{type:Boolean,required:!0},urls:{type:Array,default:()=>[]},min:{type:Number,default:1},max:{type:Number,default:1},appendToBody:{type:Boolean}},emits:["update:modelValue","finished"],setup(s,{emit:B}){const g=s,{urls:y,max:w,modelValue:a}=K(g),f=I();ae(a,()=>{a.value&&(f.value=ee.uniq(y.value).map(l=>({url:l,checked:!1})))});const r=l=>{if(l.checked){l.checked=!l.checked;return}let e=0;f.value.forEach(V=>{V.checked&&(e+=1),e>=w.value&&(V.checked=!1)}),l.checked=!0},$=()=>{B("finished",f.value.filter(l=>l.checked).map(l=>l.url)),B("update:modelValue",!1)};return(l,e)=>{const V=k("el-col"),C=k("el-row"),m=k("el-button"),c=k("el-dialog");return i(),p(c,{"model-value":s.modelValue,title:l.$t("article.extractImage"),width:768,"append-to-body":s.appendToBody,"onUpdate:modelValue":e[1]||(e[1]=b=>l.$emit("update:modelValue",b))},{footer:d(()=>[o(m,{type:"primary",disabled:f.value.filter(b=>b.checked).length<s.min,onClick:e[0]||(e[0]=()=>$())},{default:d(()=>[N(O(l.$t("ok")),1)]),_:1},8,["disabled"])]),default:d(()=>[o(C,{gutter:16},{default:d(()=>[(i(!0),h(R,null,P(f.value,b=>(i(),p(V,{key:b.url,src:b,span:8,class:"mt-2"},{default:d(()=>[X("div",{class:te(["p-1 border-2 rounded cursor-pointer text-center",{"border-primary":b.checked,"border-2":b.checked}]),onClick:()=>r(b)},[X("img",{src:b.url,class:"max-h-36 inline"},null,8,ne)],10,re)]),_:2},1032,["src"]))),128))]),_:1})]),_:1},8,["model-value","title","append-to-body"])}}}),se={name:"BlockItemForm"},ce=J({...se,props:{modelValue:{type:Boolean,required:!0},beanId:{type:Number,default:null},beanIds:{type:Array,required:!0},blockId:{type:Number,default:null},articleId:{type:Number,default:null},title:{type:String,default:null},description:{type:String,default:null},video:{type:String,default:null},images:{type:Array,default:()=>[]}},emits:{"update:modelValue":null,finished:null},setup(s){const B=s,{blockId:g}=K(B),y=I(),w=I(),a=I({}),f=I([]),r=ue(()=>f.value.find(l=>{var e;return l.id===((e=y.value)!=null?e:g==null?void 0:g.value)}));oe(async()=>{f.value=await Q()});const $=I(!1);return(l,e)=>{var L;const V=k("el-option"),C=k("el-select"),m=k("el-form-item"),c=k("el-input"),b=k("el-button"),T=k("el-switch");return i(),h("div",null,[o(le,{values:a.value,"onUpdate:values":e[14]||(e[14]=n=>a.value=n),name:l.$t("menu.content.blockItem"),"query-bean":u(Y),"create-bean":u(Z),"update-bean":u(x),"delete-bean":u(_),"bean-id":s.beanId,"bean-ids":s.beanIds,focus:w.value,"init-values":()=>({blockId:u(g),articleId:s.articleId,title:s.title,description:s.description,video:s.video}),"to-values":n=>{var q,U;return{...n,articleTitle:(q=n.article)==null?void 0:q.title,articleId:(U=n.article)==null?void 0:U.id}},addable:(L=u(r))==null?void 0:L.enabled,perms:"blockItem","model-value":s.modelValue,"onUpdate:modelValue":e[15]||(e[15]=n=>l.$emit("update:modelValue",n)),onFinished:e[16]||(e[16]=()=>l.$emit("finished")),onBeanChange:e[17]||(e[17]=n=>y.value=n.blockId)},{default:d(({isEdit:n})=>{var q,U,S,F,A,E,H,D,M,W,j,z;return[o(m,{prop:"blockId",label:l.$t("blockItem.block"),rules:{required:!0,message:()=>l.$t("v.required")}},{default:d(()=>[o(C,{modelValue:a.value.blockId,"onUpdate:modelValue":e[0]||(e[0]=t=>a.value.blockId=t),class:"w-full",disabled:"",onChange:e[1]||(e[1]=t=>y.value=t)},{default:d(()=>[(i(!0),h(R,null,P(f.value,t=>(i(),h(R,{key:t.id},[n||t.enabled?(i(),p(V,{key:0,label:t.name,value:t.id,disabled:!t.enabled},null,8,["label","value","disabled"])):v("",!0)],64))),128))]),_:2},1032,["modelValue"])]),_:2},1032,["label","rules"]),n&&a.value.articleId!=null?(i(),p(m,{key:0,label:l.$t("blockItem.articleId")},{default:d(()=>[o(c,{modelValue:a.value.articleId,"onUpdate:modelValue":e[2]||(e[2]=t=>a.value.articleId=t),disabled:""},null,8,["modelValue"])]),_:1},8,["label"])):v("",!0),n&&a.value.articleTitle!=null?(i(),p(m,{key:1,label:l.$t("blockItem.articleTitle")},{default:d(()=>[o(c,{modelValue:a.value.articleTitle,"onUpdate:modelValue":e[3]||(e[3]=t=>a.value.articleTitle=t),disabled:""},null,8,["modelValue"])]),_:1},8,["label"])):v("",!0),o(m,{prop:"title",label:l.$t("blockItem.title"),rules:{required:!0,message:()=>l.$t("v.required")}},{default:d(()=>[o(c,{ref_key:"focus",ref:w,modelValue:a.value.title,"onUpdate:modelValue":e[4]||(e[4]=t=>a.value.title=t),maxlength:"150"},null,8,["modelValue"])]),_:1},8,["label","rules"]),a.value.articleId==null&&((q=u(r))!=null&&q.withLinkUrl)?(i(),p(m,{key:2,prop:"linkUrl",label:l.$t("blockItem.linkUrl"),rules:(U=u(r))!=null&&U.linkUrlRequired?[{required:!0,message:()=>l.$t("v.required")},{pattern:/^(http|\/).*$/,message:()=>l.$t("blockItem.error.linkUrl")}]:{pattern:/^(http|\/).*$/,message:()=>l.$t("blockItem.error.linkUrl")}},{default:d(()=>[o(c,{modelValue:a.value.linkUrl,"onUpdate:modelValue":e[5]||(e[5]=t=>a.value.linkUrl=t),maxlength:"255"},null,8,["modelValue"])]),_:1},8,["label","rules"])):v("",!0),(S=u(r))!=null&&S.withSubtitle?(i(),p(m,{key:3,prop:"subtitle",label:l.$t("blockItem.subtitle"),rules:{required:(F=u(r))==null?void 0:F.subtitleRequired,message:()=>l.$t("v.required")}},{default:d(()=>[o(c,{modelValue:a.value.subtitle,"onUpdate:modelValue":e[6]||(e[6]=t=>a.value.subtitle=t),maxlength:"150"},null,8,["modelValue"])]),_:1},8,["label","rules"])):v("",!0),(A=u(r))!=null&&A.withDescription?(i(),p(m,{key:4,prop:"description",label:l.$t("blockItem.description"),rules:{required:(E=u(r))==null?void 0:E.descriptionRequired,message:()=>l.$t("v.required")}},{default:d(()=>[o(c,{modelValue:a.value.description,"onUpdate:modelValue":e[7]||(e[7]=t=>a.value.description=t),type:"textarea",rows:5,maxlength:"1000"},null,8,["modelValue"])]),_:1},8,["label","rules"])):v("",!0),(H=u(r))!=null&&H.withImage?(i(),p(m,{key:5,prop:"image",label:l.$t("blockItem.image"),rules:{required:(D=u(r))==null?void 0:D.imageRequired,message:()=>l.$t("v.required")}},{default:d(()=>[o(u(G),{modelValue:a.value.image,"onUpdate:modelValue":e[8]||(e[8]=t=>a.value.image=t),width:u(r).imageWidth,height:u(r).imageHeight,mode:"manual"},null,8,["modelValue","width","height"]),s.images.length>0?(i(),p(b,{key:0,class:"ml-2 self-start",onClick:e[9]||(e[9]=()=>$.value=!0)},{default:d(()=>[N(O(l.$t("article.extractImage")),1)]),_:1})):v("",!0)]),_:1},8,["label","rules"])):v("",!0),(M=u(r))!=null&&M.withMobileImage?(i(),p(m,{key:6,prop:"mobileImage",label:l.$t("blockItem.mobileImage"),rules:{required:(W=u(r))==null?void 0:W.mobileImageRequired,message:()=>l.$t("v.required")}},{default:d(()=>[o(u(G),{modelValue:a.value.mobileImage,"onUpdate:modelValue":e[10]||(e[10]=t=>a.value.mobileImage=t),width:u(r).mobileImageWidth,height:u(r).mobileImageHeight,mode:"manual"},null,8,["modelValue","width","height"])]),_:1},8,["label","rules"])):v("",!0),(j=u(r))!=null&&j.withVideo?(i(),p(m,{key:7,prop:"video",label:l.$t("blockItem.video"),rules:{required:(z=u(r))==null?void 0:z.videoRequired,message:()=>l.$t("v.required")}},{default:d(()=>[o(c,{modelValue:a.value.video,"onUpdate:modelValue":e[11]||(e[11]=t=>a.value.video=t),maxlength:"255"},{prepend:d(()=>[N("URL")]),_:1},8,["modelValue"]),o(u(de),{type:"video","on-success":t=>a.value.video=t.url},null,8,["on-success"])]),_:1},8,["label","rules"])):v("",!0),o(m,{prop:"targetBlank",label:l.$t("blockItem.targetBlank")},{default:d(()=>[o(T,{modelValue:a.value.targetBlank,"onUpdate:modelValue":e[12]||(e[12]=t=>a.value.targetBlank=t)},null,8,["modelValue"])]),_:1},8,["label"]),o(m,{prop:"enabled",label:l.$t("blockItem.enabled")},{default:d(()=>[o(T,{modelValue:a.value.enabled,"onUpdate:modelValue":e[13]||(e[13]=t=>a.value.enabled=t)},null,8,["modelValue"])]),_:1},8,["label"])]}),_:1},8,["values","name","query-bean","create-bean","update-bean","delete-bean","bean-id","bean-ids","focus","init-values","to-values","addable","model-value"]),o(ie,{modelValue:$.value,"onUpdate:modelValue":e[18]||(e[18]=n=>$.value=n),urls:s.images,"append-to-body":!0,onFinished:e[19]||(e[19]=n=>a.value.image=n[0])},null,8,["modelValue","urls"])])}}});export{ie as _,ce as a};
