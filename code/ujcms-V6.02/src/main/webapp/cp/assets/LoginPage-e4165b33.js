import{d as J,u as j,r as e,o as Q,q as W,a as d,b as te,c as M,e as L,w as u,f as oe,g as N,h as a,i as m,s as S,j as F,k as R,t as T,l as z,m as O,n as re,E as X,p as ue,v as ne,x as ie,y as Y,z as Z,A as ee,B as de,C as pe,D as me,F as ce,G as ve,H as fe,I as ge,J as we,K as he,L as ye,M as be,N as Ve,O as _e,P as $e,_ as Me}from"./index-285670b0.js";const ke={name:"ChangePassword"},qe=J({...ke,props:{modelValue:{type:Boolean,required:!0}},emits:{"update:modelValue":null},setup(E,{emit:k}){const{t:U}=j(),l=e({}),V=e(),y=e(),_=e(!1),c=e(!1),v=e(""),f=e();Q(async()=>{_.value=!0;try{v.value=await W()}finally{_.value=!1}});const q=()=>{V.value.validate(async s=>{if(s){c.value=!0;try{const i=O(l.value.password,v.value),I=O(l.value.newPassword,v.value),t=await re({...l.value,password:i,newPassword:I,passwordAgain:void 0});if(t.status!==0){f.value=t.message;return}f.value=void 0,V.value.resetFields(),X.success(U("success")),k("update:modelValue",!1)}finally{c.value=!1}}})};return(s,i)=>{const I=d("el-alert"),t=d("el-input"),n=d("el-form-item"),b=d("el-button"),C=d("el-form"),g=d("el-dialog"),P=te("loading");return M(),L(g,{title:s.$t("changePassword"),"model-value":E.modelValue,"onUpdate:modelValue":i[4]||(i[4]=p=>s.$emit("update:modelValue",p)),onOpened:i[5]||(i[5]=()=>{var p;(p=y.value)==null||p.focus(),V.value.resetFields()})},{default:u(()=>[oe((M(),L(C,{ref_key:"form",ref:V,model:l.value,"label-width":"150px","label-position":"right"},{default:u(()=>[f.value?(M(),L(I,{key:0,title:f.value,type:"error",class:"mb-3",closable:!1,"show-icon":""},null,8,["title"])):N("",!0),a(n,{prop:"username",label:s.$t("user.username"),rules:[{required:!0,message:()=>s.$t("v.required")}]},{default:u(()=>[a(t,{ref_key:"focus",ref:y,modelValue:l.value.username,"onUpdate:modelValue":i[0]||(i[0]=p=>l.value.username=p),maxlength:"30"},null,8,["modelValue"])]),_:1},8,["label","rules"]),a(n,{prop:"password",label:s.$t("user.origPassword"),rules:[{required:!0,message:()=>s.$t("v.required")}]},{default:u(()=>[a(t,{modelValue:l.value.password,"onUpdate:modelValue":i[1]||(i[1]=p=>l.value.password=p),maxlength:"50","show-password":""},null,8,["modelValue"])]),_:1},8,["label","rules"]),a(n,{prop:"newPassword",label:s.$t("user.newPassword"),rules:[{required:!0,message:()=>s.$t("v.required")},{min:m(S).passwordMinLength,max:m(S).passwordMaxLength,message:()=>s.$t("user.error.passwordLength",{min:m(S).passwordMinLength,max:m(S).passwordMaxLength})},{pattern:new RegExp(m(S).passwordPattern),message:()=>s.$t(`user.error.passwordPattern.${m(S).passwordStrength}`)}]},{default:u(()=>[a(t,{modelValue:l.value.newPassword,"onUpdate:modelValue":i[2]||(i[2]=p=>l.value.newPassword=p),maxlength:m(S).passwordMaxLength,"show-password":""},null,8,["modelValue","maxlength"])]),_:1},8,["label","rules"]),a(n,{prop:"passwordAgain",label:s.$t("user.passwordAgain"),rules:[{required:!0,message:()=>s.$t("v.required")},{validator:(p,D,x)=>{if(D!==l.value.newPassword){x(s.$t("user.error.passwordNotMatch"));return}x()}}]},{default:u(()=>[a(t,{modelValue:l.value.passwordAgain,"onUpdate:modelValue":i[3]||(i[3]=p=>l.value.passwordAgain=p),maxlength:"50","show-password":""},null,8,["modelValue"])]),_:1},8,["label","rules"]),F("div",null,[a(b,{loading:c.value,type:"primary","native-type":"submit",onClick:z(q,["prevent"])},{default:u(()=>[R(T(s.$t("submit")),1)]),_:1},8,["loading","onClick"])])]),_:1},8,["model"])),[[P,_.value]])]),_:1},8,["title","model-value"])}}}),Ce={name:"GetShortMessage"},Pe=J({...Ce,props:{modelValue:{type:Boolean,required:!0}},emits:{"update:modelValue":null,finish:null},setup(E,{emit:k}){const U=E,{modelValue:l}=ue(U),{t:V}=j(),y=e(),_=e(),c=e({}),v=e(!1),f=e(),q=e(),s=e(),i=async()=>{const{token:t,image:n}=await ee();q.value="data:image/png;base64,"+n,s.value=t};ne(l,()=>{l.value&&i()});const I=()=>{y.value.validate(async t=>{var n;if(t){v.value=!0;try{const b=await de((n=s.value)!=null?n:"",c.value.captcha,c.value.mobile,3);if(b.status!==0){f.value=b.message;return}f.value=void 0,y.value.resetFields(),X.success(V("success")),k("finish",b.result.shortMessageId),k("update:modelValue",!1)}finally{v.value=!1}}})};return(t,n)=>{const b=d("el-alert"),C=d("el-input"),g=d("el-form-item"),P=d("el-image"),p=d("el-button"),D=d("el-form"),x=d("el-dialog");return M(),L(x,{title:t.$t("getShortMessage"),"model-value":E.modelValue,width:"576px","onUpdate:modelValue":n[3]||(n[3]=w=>t.$emit("update:modelValue",w)),onOpened:n[4]||(n[4]=()=>{var w;(w=_.value)==null||w.focus(),y.value.resetFields()})},{default:u(()=>[a(D,{ref_key:"form",ref:y,model:c.value,"label-width":"150px","label-position":"right"},{default:u(()=>[f.value?(M(),L(b,{key:0,title:f.value,type:"error",class:"mb-3",closable:!1,"show-icon":""},null,8,["title"])):N("",!0),a(g,{prop:"mobile",label:t.$t("mobile"),rules:[{required:!0,message:()=>t.$t("v.required")},{asyncValidator:async(w,B,o)=>{if(await m(ie)(B)){o(t.$t("mobileNotExist"));return}o()},trigger:"blur"}]},{default:u(()=>[a(C,{ref_key:"focus",ref:_,modelValue:c.value.mobile,"onUpdate:modelValue":n[0]||(n[0]=w=>c.value.mobile=w),maxlength:"30"},null,8,["modelValue"])]),_:1},8,["label","rules"]),a(g,{prop:"captcha",label:t.$t("captcha"),rules:[{required:!0,message:()=>t.$t("v.required")},{asyncValidator:async(w,B,o)=>{if(s.value==null||!await m(Y)(s.value,B)){o(t.$t("captchaIncorrect"));return}o()},trigger:"blur"}],class:"captcha"},{default:u(()=>[a(C,{modelValue:c.value.captcha,"onUpdate:modelValue":n[2]||(n[2]=w=>c.value.captcha=w),name:"captcha",placeholder:t.$t("captcha"),"prefix-icon":m(Z)},{append:u(()=>[a(P,{src:q.value,style:{height:"30px","margin-right":"1px"},class:"rounded-r cursor-pointer",title:t.$t("clickToRetrieveCaptcha"),onClick:n[1]||(n[1]=()=>i())},null,8,["src","title"])]),_:1},8,["modelValue","placeholder","prefix-icon"])]),_:1},8,["label","rules"]),F("div",null,[a(p,{loading:v.value,type:"primary","native-type":"submit",onClick:z(I,["prevent"])},{default:u(()=>[R(T(t.$t("submit")),1)]),_:1},8,["loading","onClick"])])]),_:1},8,["model"])]),_:1},8,["title","model-value"])}}}),Le={class:"h-full p-3 bg-gray-100"},Ie={class:"py-5 text-center text-3xl font-bold text-primary"},Se={class:"mt-2 text-right"},Ue=J({__name:"LoginPage",setup(E){const{t:k}=j(),U=e(),l=e({}),V=e(),y=e(!1),_=e(!1),c=e(),v=e(),f=e(),q=e(),s=e(!1),i=e(),I=pe(),t=me(),n="UJCMS",b=e(!1),C=e(!1),g=e(60),P=e(k("getShortMessage"));ce(),ve();const p=async()=>{const{token:o,image:r}=await ee();c.value="data:image/png;base64,"+r,v.value=o},D=async()=>{y.value=await be(),y.value&&p()},x=async()=>{_.value=await Ve()};Q(async()=>{V.value.focus(),V.value.select(),D(),x()}),fe(()=>{i.value=I.query.redirect});const w=o=>{f.value=o,g.value-=1,P.value=String(g.value);const r=setInterval(()=>{g.value-=1,P.value=String(g.value),g.value<=0&&(P.value=k("getShortMessage"),g.value=60,clearInterval(r))},1e3)},B=()=>{U.value.validate(async o=>{if(o){s.value=!0;try{const r=await W(),K=O(l.value.password,r),$=await _e({...l.value,password:K,captchaToken:v.value,shortMessageId:f.value});if($.status!==0){D(),q.value=$.message;return}$.result.remainingDays!=null&&$e.alert(k("passwordRemaingDays",{remainingDays:$.result.remainingDays}),{type:"warning"}),i.value?t.push(i.value):window.location.reload()}finally{s.value=!1}}})};return(o,r)=>{const K=d("el-alert"),$=d("el-input"),A=d("el-form-item"),G=d("el-button"),ae=d("el-image"),le=d("el-form");return M(),ge("div",Le,[a(le,{ref_key:"form",ref:U,model:l.value,class:"mx-auto md:max-w-xs"},{default:u(()=>[F("h3",Ie,T(m(n)),1),q.value?(M(),L(K,{key:0,title:q.value,type:"error",class:"mb-3",closable:!1,"show-icon":""},null,8,["title"])):N("",!0),a(A,{prop:"username",rules:[{required:!0,message:()=>o.$t("v.required")}]},{default:u(()=>[a($,{ref_key:"focus",ref:V,modelValue:l.value.username,"onUpdate:modelValue":r[0]||(r[0]=h=>l.value.username=h),name:"username",placeholder:o.$t("username"),"prefix-icon":m(we),autocomplete:"on"},null,8,["modelValue","placeholder","prefix-icon"])]),_:1},8,["rules"]),a(A,{prop:"password",rules:[{required:!0,message:()=>o.$t("v.required")}]},{default:u(()=>[a($,{ref:"password",modelValue:l.value.password,"onUpdate:modelValue":r[1]||(r[1]=h=>l.value.password=h),type:"password",name:"password",placeholder:o.$t("password"),"prefix-icon":m(he),"show-password":""},null,8,["modelValue","placeholder","prefix-icon"])]),_:1},8,["rules"]),_.value?(M(),L(A,{key:1,prop:"shortMessageValue",rules:[{required:!0,message:()=>o.$t("v.required")}]},{default:u(()=>[a($,{modelValue:l.value.shortMessageValue,"onUpdate:modelValue":r[3]||(r[3]=h=>l.value.shortMessageValue=h),name:"shortMessageValue",placeholder:o.$t("shortMessage"),"prefix-icon":m(ye)},{append:u(()=>[a(G,{disabled:g.value<60,onClick:r[2]||(r[2]=()=>C.value=!0)},{default:u(()=>[R(T(P.value),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue","placeholder","prefix-icon"])]),_:1},8,["rules"])):N("",!0),y.value?(M(),L(A,{key:2,prop:"captcha",rules:[{required:!0,message:()=>o.$t("v.required")},{asyncValidator:async(h,se,H)=>{if(v.value==null||!await m(Y)(v.value,se)){H(o.$t("captchaIncorrect"));return}H()},trigger:"blur"}],class:"captcha"},{default:u(()=>[a($,{modelValue:l.value.captcha,"onUpdate:modelValue":r[5]||(r[5]=h=>l.value.captcha=h),name:"captcha",placeholder:o.$t("captcha"),"prefix-icon":m(Z)},{append:u(()=>[a(ae,{src:c.value,style:{height:"30px","margin-right":"1px"},class:"rounded-r cursor-pointer",title:o.$t("clickToRetrieveCaptcha"),onClick:r[4]||(r[4]=()=>p())},null,8,["src","title"])]),_:1},8,["modelValue","placeholder","prefix-icon"])]),_:1},8,["rules"])):N("",!0),a(G,{type:"primary","native-type":"submit",class:"w-full",loading:s.value,onClick:z(B,["prevent"])},{default:u(()=>[R(T(o.$t("login")),1)]),_:1},8,["loading","onClick"]),F("div",Se,[a(G,{type:"primary",link:"",onClick:r[6]||(r[6]=()=>b.value=!0)},{default:u(()=>[R(T(o.$t("changePassword")),1)]),_:1})])]),_:1},8,["model"]),a(qe,{modelValue:b.value,"onUpdate:modelValue":r[7]||(r[7]=h=>b.value=h)},null,8,["modelValue"]),a(Pe,{modelValue:C.value,"onUpdate:modelValue":r[8]||(r[8]=h=>C.value=h),onFinish:w},null,8,["modelValue"])])}}});const xe=Me(Ue,[["__scopeId","data-v-ab3ba95c"]]);export{xe as default};
